# Prompt 工程最佳实践

> 定义构建有效 Prompt 的结构化方法和模板。

---

## 1. Prompt 结构模板

### 1.1 标准结构

```
[角色定义]
你是一个专业的 {角色}，具备 {专业领域} 的专业知识。

[任务背景]
{提供必要的背景信息}

[具体任务]
请完成以下任务：
{明确的任务描述}

[输入数据]
{需要处理的数据}

[输出要求]
请按以下格式输出：
{输出格式说明}

[约束条件]
注意事项：
- {约束1}
- {约束2}
```

### 1.2 示例

```
你是一个专业的代码审查专家，具备多年软件开发和架构设计经验。

我需要你审查一段 Python 代码，重点关注代码质量、安全性和可维护性。

请完成以下任务：
1. 识别代码中的问题和潜在风险
2. 提供具体的改进建议
3. 评估代码的整体质量

代码如下：
```python
{code}
```

请按以下 JSON 格式输出：
```json
{
  "issues": [
    {"severity": "high|medium|low", "line": 1, "description": "问题描述"}
  ],
  "suggestions": ["建议1", "建议2"],
  "quality_score": 1-10
}
```

注意事项：
- 只关注代码本身，不要评论代码风格偏好
- severity 必须是 high/medium/low 之一
- quality_score 必须是 1-10 的整数
```

---

## 2. 信息分级

### 2.1 三级分类

| 级别 | 说明 | 处理方式 |
|------|------|----------|
| Must Have | 任务核心信息 | 必须包含，放在显眼位置 |
| Should Have | 有助于提升质量的信息 | 建议包含 |
| Nice to Have | 补充信息 | 可选，避免信息过载 |

### 2.2 应用示例

```
# Must Have（必须）
- 任务目标：评估代码质量
- 输入数据：代码内容
- 输出格式：JSON

# Should Have（建议）
- 评估维度：安全性、可维护性、性能
- 严重级别定义

# Nice to Have（可选）
- 代码的业务背景
- 历史变更信息
```

---

## 3. 输出格式约束

### 3.1 JSON 输出

```
请严格按照以下 JSON 格式输出，不要包含其他内容：

```json
{
  "field1": "string 类型",
  "field2": 123,
  "field3": ["数组", "元素"],
  "field4": {
    "nested": "对象"
  }
}
```

注意：
- 所有字段都是必填的
- 不要添加额外字段
- 确保 JSON 格式有效
```

### 3.2 结构化文本

```
请按以下格式输出：

## 摘要
[一句话总结]

## 详细分析
### 优点
- 优点1
- 优点2

### 问题
- 问题1
- 问题2

## 建议
1. 建议1
2. 建议2
```

### 3.3 枚举约束

```
status 字段必须是以下值之一：
- "approved": 已批准
- "rejected": 已拒绝
- "pending": 待处理

不要使用其他值。
```

---

## 4. Few-shot 示例

### 4.1 格式

```
以下是一些示例：

示例 1：
输入：{input1}
输出：{output1}

示例 2：
输入：{input2}
输出：{output2}

现在，请处理以下输入：
输入：{actual_input}
输出：
```

### 4.2 示例数量建议

| 任务复杂度 | 示例数量 |
|------------|----------|
| 简单格式转换 | 1-2 |
| 中等复杂度 | 2-3 |
| 复杂判断任务 | 3-5 |

---

## 5. Chain of Thought (CoT)

### 5.1 基本格式

```
请一步步思考，然后给出答案：

1. 首先，分析 {aspect1}
2. 然后，考虑 {aspect2}
3. 接下来，评估 {aspect3}
4. 最后，综合以上分析，给出结论

请在最终答案前展示你的思考过程。
```

### 5.2 示例

```
请评估这段代码的安全性：

```python
def login(username, password):
    query = f"SELECT * FROM users WHERE name='{username}' AND pass='{password}'"
    return db.execute(query)
```

请一步步分析：
1. 检查输入处理方式
2. 识别潜在的安全漏洞
3. 评估风险级别
4. 提供修复建议
```

---

## 6. 角色扮演

### 6.1 专业角色

```python
ROLES = {
    "code_reviewer": """
你是一位资深软件工程师，拥有 10 年以上代码审查经验。
你熟悉 SOLID 原则、设计模式和常见的安全漏洞。
你的审查风格是严谨但建设性的。
""",
    
    "technical_writer": """
你是一位技术文档专家，擅长将复杂技术概念解释清楚。
你的写作风格简洁明了，注重实用性。
你总是提供具体的代码示例来说明概念。
""",
    
    "security_analyst": """
你是一位安全专家，专注于应用程序安全。
你熟悉 OWASP Top 10 和常见的攻击向量。
你会从攻击者的角度审视代码。
""",
}
```

### 6.2 使用

```python
def create_prompt(role: str, task: str, data: str) -> str:
    return f"""
{ROLES[role]}

任务：{task}

数据：
{data}
"""
```

---

## 7. 常见陷阱

### 7.1 避免模糊指令

```
# ❌ 模糊
请分析这段代码。

# ✅ 明确
请从以下三个维度分析这段代码：
1. 代码质量（可读性、可维护性）
2. 性能（时间复杂度、空间复杂度）
3. 安全性（输入验证、敏感数据处理）
```

### 7.2 避免过长 Prompt

```
# ❌ 过长
[包含大量背景信息、历史数据、无关细节...]

# ✅ 精简
[只包含完成任务所需的核心信息]
```

### 7.3 避免矛盾指令

```
# ❌ 矛盾
请详细分析，但回答要简短。

# ✅ 一致
请用 3-5 句话总结主要发现，然后用列表列出具体问题。
```

---

## 8. Prompt 模板库

### 8.1 代码审查

```python
CODE_REVIEW_PROMPT = """
你是一位资深代码审查专家。

请审查以下 {language} 代码：

```{language}
{code}
```

评估维度：
1. 代码质量（可读性、命名、结构）
2. 潜在 Bug（边界条件、空值处理）
3. 安全风险（注入、敏感数据）
4. 性能问题（复杂度、资源使用）

输出格式：
```json
{{
  "summary": "一句话总结",
  "issues": [
    {{"severity": "high|medium|low", "category": "类别", "description": "描述", "suggestion": "建议"}}
  ],
  "score": 1-10
}}
```
"""
```

### 8.2 文档生成

```python
DOC_GENERATION_PROMPT = """
请为以下函数生成文档：

```{language}
{code}
```

输出格式：
```{language}
{docstring_format}
```

要求：
- 描述函数用途
- 说明每个参数
- 说明返回值
- 列出可能的异常
- 提供使用示例
"""
```

---

## 9. 调试技巧

### 9.1 输出诊断

```
在回答之前，请先输出你对任务的理解：
1. 你认为任务目标是什么？
2. 你需要处理的输入是什么？
3. 你计划如何完成？

然后再给出正式答案。
```

### 9.2 温度调节

| 场景 | 温度 | 说明 |
|------|------|------|
| 格式化输出 | 0.0-0.3 | 高一致性 |
| 代码生成 | 0.3-0.5 | 平衡创造和准确 |
| 创意写作 | 0.7-1.0 | 高创造性 |
| JSON 输出 | 0.1 | 最大一致性 |

---

*此文件为 AI 集成技能的一部分*
*协议版本: 2.1.0*
